"use strict";(self.webpackChunkdatacraft_school=self.webpackChunkdatacraft_school||[]).push([[1559],{4719:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"snowflake-semi-structured-data","title":"Handling Semi-Structured Data (JSON, XML, Avro)","description":"A story-driven guide to handling semi-structured data in Snowflake, including JSON, XML, and Avro, with practical examples, VARIANT data type, and query best practices.","source":"@site/docs-snowflake/snowflake-semi-structured-data.md","sourceDirName":".","slug":"/snowflake-semi-structured-data","permalink":"/snowflake/snowflake-semi-structured-data","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"snowflake-semi-structured-data","title":"Handling Semi-Structured Data (JSON, XML, Avro)","sidebar_label":"Semi-Structured Data","description":"A story-driven guide to handling semi-structured data in Snowflake, including JSON, XML, and Avro, with practical examples, VARIANT data type, and query best practices.","keywords":["Snowflake semi-structured data","Snowflake JSON","Snowflake XML","Snowflake Avro","Snowflake VARIANT type","querying semi-structured data"]},"sidebar":"tutorialSidebar1","previous":{"title":"Performance Tuning","permalink":"/snowflake/snowflake-performance-tuning"},"next":{"title":"Flatten & VARIANT","permalink":"/snowflake/snowflake-flatten-variant"}}');var t=r(4848),a=r(8453);const l={id:"snowflake-semi-structured-data",title:"Handling Semi-Structured Data (JSON, XML, Avro)",sidebar_label:"Semi-Structured Data",description:"A story-driven guide to handling semi-structured data in Snowflake, including JSON, XML, and Avro, with practical examples, VARIANT data type, and query best practices.",keywords:["Snowflake semi-structured data","Snowflake JSON","Snowflake XML","Snowflake Avro","Snowflake VARIANT type","querying semi-structured data"]},d="Handling Semi-Structured Data (JSON, XML, Avro)",i={},c=[{value:"\u2728 Story Time \u2014 \u201cHow Do I Query JSON in Snowflake?\u201d",id:"-story-time--how-do-i-query-json-in-snowflake",level:2},{value:"\ud83e\uddf1 Step 1: Understanding Snowflake VARIANT Type",id:"-step-1-understanding-snowflake-variant-type",level:2},{value:"Example:",id:"example",level:3},{value:"2\ufe0f\u20e3 Loading Semi-Structured Data",id:"2\ufe0f\u20e3-loading-semi-structured-data",level:2},{value:"JSON Example:",id:"json-example",level:3},{value:"XML Example:",id:"xml-example",level:3},{value:"Avro Example:",id:"avro-example",level:3},{value:"3\ufe0f\u20e3 Querying JSON / XML / Avro",id:"3\ufe0f\u20e3-querying-json--xml--avro",level:2},{value:"JSON Example:",id:"json-example-1",level:3},{value:"XML Example:",id:"xml-example-1",level:3},{value:"Avro Example:",id:"avro-example-1",level:3},{value:"4\ufe0f\u20e3 Flattening Nested Arrays",id:"4\ufe0f\u20e3-flattening-nested-arrays",level:2},{value:"\ud83e\uddea Real-World Story \u2014 Arjun Queries SaaS Data",id:"-real-world-story--arjun-queries-saas-data",level:2},{value:"\ud83d\udca1 Best Practices",id:"-best-practices",level:2},{value:"\ud83d\udcd8 Summary",id:"-summary",level:2}];function o(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"handling-semi-structured-data-json-xml-avro",children:"Handling Semi-Structured Data (JSON, XML, Avro)"})}),"\n",(0,t.jsx)(n.h2,{id:"-story-time--how-do-i-query-json-in-snowflake",children:"\u2728 Story Time \u2014 \u201cHow Do I Query JSON in Snowflake?\u201d"}),"\n",(0,t.jsx)(n.p,{children:"Arjun, a data engineer, just received a dataset from a new SaaS platform."}),"\n",(0,t.jsx)(n.p,{children:"Problem:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Data is ",(0,t.jsx)(n.strong,{children:"JSON files"})]}),"\n",(0,t.jsx)(n.li,{children:"Nested arrays, mixed types, dynamic fields"}),"\n",(0,t.jsxs)(n.li,{children:["Exported as ",(0,t.jsx)(n.strong,{children:"XML"})," for another system"]}),"\n",(0,t.jsxs)(n.li,{children:["Some files in ",(0,t.jsx)(n.strong,{children:"Avro"})," format"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"He\u2019s used to traditional relational tables and asks:"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\u201cDo I need to flatten everything into columns? Do I need to preprocess outside Snowflake?\u201d"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The answer: ",(0,t.jsx)(n.strong,{children:"No. Snowflake makes semi-structured data easy."})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-step-1-understanding-snowflake-variant-type",children:"\ud83e\uddf1 Step 1: Understanding Snowflake VARIANT Type"}),"\n",(0,t.jsxs)(n.p,{children:["Snowflake uses ",(0,t.jsx)(n.strong,{children:"VARIANT"})," to store semi-structured data:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"JSON"}),"\n",(0,t.jsx)(n.li,{children:"XML"}),"\n",(0,t.jsx)(n.li,{children:"Avro"}),"\n",(0,t.jsx)(n.li,{children:"Parquet"}),"\n",(0,t.jsx)(n.li,{children:"ORC"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"example",children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE raw_data (\r\n    id STRING,\r\n    data VARIANT\r\n);\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Input:"}),"\r\nDeclaring a table with two columns (",(0,t.jsx)(n.code,{children:"id"}),", ",(0,t.jsx)(n.code,{children:"data"}),")."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Output:"}),"\r\nAn empty table ",(0,t.jsx)(n.code,{children:"raw_data"})," is created successfully."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"2\ufe0f\u20e3-loading-semi-structured-data",children:"2\ufe0f\u20e3 Loading Semi-Structured Data"}),"\n",(0,t.jsx)(n.h3,{id:"json-example",children:"JSON Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"COPY INTO raw_data\r\nFROM @my_stage/json_files/\r\nFILE_FORMAT = (TYPE = 'JSON');\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Input:"}),"\r\nJSON files staged in: ",(0,t.jsx)(n.code,{children:"@my_stage/json_files/"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Output:"}),"\r\nRows inserted into ",(0,t.jsx)(n.code,{children:"raw_data"})," with JSON parsed as VARIANT."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"xml-example",children:"XML Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"COPY INTO raw_data\r\nFROM @my_stage/xml_files/\r\nFILE_FORMAT = (TYPE = 'XML');\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Input:"}),"\r\nXML files staged in: ",(0,t.jsx)(n.code,{children:"@my_stage/xml_files/"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Output:"}),"\r\nXML is parsed and stored in the VARIANT column."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"avro-example",children:"Avro Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"COPY INTO raw_data\r\nFROM @my_stage/avro_files/\r\nFILE_FORMAT = (TYPE = 'AVRO');\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Input:"}),"\r\nAvro files located in: ",(0,t.jsx)(n.code,{children:"@my_stage/avro_files/"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Output:"}),"\r\nAvro data is loaded and schema interpreted automatically."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"3\ufe0f\u20e3-querying-json--xml--avro",children:"3\ufe0f\u20e3 Querying JSON / XML / Avro"}),"\n",(0,t.jsx)(n.h3,{id:"json-example-1",children:"JSON Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT\r\n    data:customer.name AS customer_name,\r\n    data:customer.address.city AS city\r\nFROM raw_data\r\nWHERE data:customer.age > 30;\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Input (sample JSON):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "customer": {\r\n    "name": "John",\r\n    "age": 35,\r\n    "address": { "city": "Bangalore" }\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Output:"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"customer_name"}),(0,t.jsx)(n.th,{children:"city"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"John"}),(0,t.jsx)(n.td,{children:"Bangalore"})]})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"xml-example-1",children:"XML Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'SELECT\r\n    data:"customer"."name"::STRING AS customer_name,\r\n    data:"customer"."address"."city"::STRING AS city\r\nFROM raw_data;\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Input (sample XML):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"<customer>\r\n  <name>Arjun</name>\r\n  <address><city>Hyderabad</city></address>\r\n</customer>\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Output:"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"customer_name"}),(0,t.jsx)(n.th,{children:"city"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Arjun"}),(0,t.jsx)(n.td,{children:"Hyderabad"})]})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"avro-example-1",children:"Avro Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT\r\n    data:key1::STRING AS key1_value,\r\n    data:key2::NUMBER AS key2_value\r\nFROM raw_data;\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Input:"}),"\r\nAvro record with fields ",(0,t.jsx)(n.code,{children:"key1"}),", ",(0,t.jsx)(n.code,{children:"key2"}),"."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Output:"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"key1_value"}),(0,t.jsx)(n.th,{children:"key2_value"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:'"A123"'}),(0,t.jsx)(n.td,{children:"90"})]})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"4\ufe0f\u20e3-flattening-nested-arrays",children:"4\ufe0f\u20e3 Flattening Nested Arrays"}),"\n",(0,t.jsx)(n.p,{children:"Example JSON:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "customer": "John",\r\n  "orders": [\r\n    { "id": 1, "amount": 100 },\r\n    { "id": 2, "amount": 150 }\r\n  ]\r\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Query:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT\r\n    data:customer AS customer,\r\n    f.value:id AS order_id,\r\n    f.value:amount AS order_amount\r\nFROM raw_data,\r\nLATERAL FLATTEN(input => data:orders) f;\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Input:"}),"\r\nOrders array with two objects."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Output:"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"customer"}),(0,t.jsx)(n.th,{children:"order_id"}),(0,t.jsx)(n.th,{children:"order_amount"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"John"}),(0,t.jsx)(n.td,{children:"1"}),(0,t.jsx)(n.td,{children:"100"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"John"}),(0,t.jsx)(n.td,{children:"2"}),(0,t.jsx)(n.td,{children:"150"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-real-world-story--arjun-queries-saas-data",children:"\ud83e\uddea Real-World Story \u2014 Arjun Queries SaaS Data"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT\r\n    f.value:eventType AS event_type,\r\n    COUNT(*) AS total_events\r\nFROM raw_data,\r\nLATERAL FLATTEN(input => data:events) f\r\nGROUP BY event_type\r\nORDER BY total_events DESC;\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Input:"}),"\r\nVARIANT object containing millions of event records."]}),"\n",(0,t.jsx)(n.p,{children:"Example small sample:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "events": [\r\n    { "eventType": "login" },\r\n    { "eventType": "purchase" },\r\n    { "eventType": "logout" }\r\n  ]\r\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Output (example):"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"event_type"}),(0,t.jsx)(n.th,{children:"total_events"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"login"}),(0,t.jsx)(n.td,{children:"20000000"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"purchase"}),(0,t.jsx)(n.td,{children:"15000000"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"logout"}),(0,t.jsx)(n.td,{children:"10000000"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-best-practices",children:"\ud83d\udca1 Best Practices"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.strong,{children:"VARIANT"})," for raw storage \u2014 flexible and efficient"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Flatten only when needed"})," \u2014 avoid unnecessary row explosion"]}),"\n",(0,t.jsx)(n.li,{children:"Filter early to reduce scanned micro-partitions"}),"\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.strong,{children:"materialized views"})," for repeated queries"]}),"\n",(0,t.jsxs)(n.li,{children:["Cast fields using ",(0,t.jsx)(n.code,{children:"::TYPE"})," when required"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-summary",children:"\ud83d\udcd8 Summary"}),"\n",(0,t.jsx)(n.p,{children:"Snowflake simplifies handling semi-structured data:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Store JSON, XML, Avro directly in ",(0,t.jsx)(n.strong,{children:"VARIANT"})]}),"\n",(0,t.jsxs)(n.li,{children:["Query with ",(0,t.jsx)(n.strong,{children:"dot notation"})," and ",(0,t.jsx)(n.strong,{children:"FLATTEN"})]}),"\n",(0,t.jsx)(n.li,{children:"Nested and dynamic fields supported"}),"\n",(0,t.jsx)(n.li,{children:"No preprocessing or schema migration needed"}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Handling semi-structured data becomes ",(0,t.jsx)(n.strong,{children:"fast, scalable, and simple"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h1,{id:"-next-topic",children:"\ud83d\udc49 Next Topic"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Flatten Function & VARIANT Type \u2014 Real Use Cases"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\r\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>d});var s=r(6540);const t={},a=s.createContext(t);function l(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);