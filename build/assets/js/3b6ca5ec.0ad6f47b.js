"use strict";(self.webpackChunkdatacraft_school=self.webpackChunkdatacraft_school||[]).push([[911],{8301:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>l,contentTitle:()=>t,default:()=>d,frontMatter:()=>c,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"databricks-caching-best-practices","title":"Caching in Databricks \u2014 Best Practices for Faster Queries","description":"Learn how caching works in Databricks, when to use it, when to avoid it, and how to dramatically improve Lakehouse query performance with a story-driven explanation.","source":"@site/docs-databricks/databricks-caching-best-practices.md","sourceDirName":".","slug":"/databricks-caching-best-practices","permalink":"/databricks/databricks-caching-best-practices","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"databricks-caching-best-practices","title":"Caching in Databricks \u2014 Best Practices for Faster Queries","sidebar_label":"Caching Best Practices","description":"Learn how caching works in Databricks, when to use it, when to avoid it, and how to dramatically improve Lakehouse query performance with a story-driven explanation.","keywords":["Databricks caching","Delta cache","Databricks performance tuning","memory cache spark","accelerate queries Databricks"]},"sidebar":"tutorialSidebar2","previous":{"title":"File Compaction","permalink":"/databricks/databricks-file-compaction"},"next":{"title":"Photon Engine","permalink":"/databricks/databricks-photon-engine"}}');var i=n(4848),r=n(8453);const c={id:"databricks-caching-best-practices",title:"Caching in Databricks \u2014 Best Practices for Faster Queries",sidebar_label:"Caching Best Practices",description:"Learn how caching works in Databricks, when to use it, when to avoid it, and how to dramatically improve Lakehouse query performance with a story-driven explanation.",keywords:["Databricks caching","Delta cache","Databricks performance tuning","memory cache spark","accelerate queries Databricks"]},t="Caching in Databricks \u2014 Best Practices",l={},o=[{value:"\u2728 Story Time \u2014 \u201cMy Query Is Fast\u2026 But Only the Second Time?\u201d",id:"-story-time--my-query-is-fast-but-only-the-second-time",level:2},{value:"\ud83e\udde9 What Is Caching in Databricks?",id:"-what-is-caching-in-databricks",level:2},{value:"\ud83d\udd0d Type 1: Delta Cache (Databricks Runtime)",id:"-type-1-delta-cache-databricks-runtime",level:2},{value:"How it works:",id:"how-it-works",level:3},{value:"Enable (if disabled):",id:"enable-if-disabled",level:3},{value:"\ud83d\udd0d Type 2: Spark Memory Cache",id:"-type-2-spark-memory-cache",level:2},{value:"Best for:",id:"best-for",level:3},{value:"Limitations:",id:"limitations",level:3},{value:"\ud83d\udd0d Type 3: Databricks SQL Warehouse Cache",id:"-type-3-databricks-sql-warehouse-cache",level:2},{value:"Benefits:",id:"benefits",level:3},{value:"\u26a1 When Should You Use Caching?",id:"-when-should-you-use-caching",level:2},{value:"\u2705 Use caching when:",id:"-use-caching-when",level:3},{value:"\u274c When NOT to Use Caching",id:"-when-not-to-use-caching",level:2},{value:"Avoid caching when:",id:"avoid-caching-when",level:3},{value:"\ud83e\uddea Real-World Example \u2014 8\xd7 Faster Dashboard",id:"-real-world-example--8-faster-dashboard",level:2},{value:"\ud83d\udd27 How to Check If Cache Is Being Used",id:"-how-to-check-if-cache-is-being-used",level:2},{value:"\ud83c\udfaf Best Practices for Caching",id:"-best-practices-for-caching",level:2},{value:"\ud83d\udfe9 1. Cache only hot datasets",id:"-1-cache-only-hot-datasets",level:3},{value:"\ud83d\udfe9 2. Use Delta Cache for most SQL workloads",id:"-2-use-delta-cache-for-most-sql-workloads",level:3},{value:"\ud83d\udfe9 3. Use MEMORY cache only for DataFrame-heavy notebooks",id:"-3-use-memory-cache-only-for-dataframe-heavy-notebooks",level:3},{value:"\ud83d\udfe9 4. Don\u2019t over-cache",id:"-4-dont-over-cache",level:3},{value:"\ud83d\udfe9 5. Combine caching with Z-ORDER + OPTIMIZE",id:"-5-combine-caching-with-z-order--optimize",level:3},{value:"\ud83d\udfe9 6. Tune cache size for large clusters",id:"-6-tune-cache-size-for-large-clusters",level:3},{value:"\ud83d\udcd8 Summary",id:"-summary",level:2}];function h(e){const a={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.header,{children:(0,i.jsx)(a.h1,{id:"caching-in-databricks--best-practices",children:"Caching in Databricks \u2014 Best Practices"})}),"\n",(0,i.jsx)(a.h2,{id:"-story-time--my-query-is-fast-but-only-the-second-time",children:"\u2728 Story Time \u2014 \u201cMy Query Is Fast\u2026 But Only the Second Time?\u201d"}),"\n",(0,i.jsx)(a.p,{children:"Mila, a data analyst, runs a heavy analytical query:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-sql",children:"SELECT region, SUM(total_sales)\r\nFROM transactions\r\nGROUP BY region;\n"})}),"\n",(0,i.jsxs)(a.p,{children:["The first time: ",(0,i.jsx)(a.strong,{children:"30 seconds"}),"\r\nThe second time: ",(0,i.jsx)(a.strong,{children:"4 seconds"})]}),"\n",(0,i.jsxs)(a.p,{children:["She wonders: ",(0,i.jsx)(a.em,{children:"\u201cWhy is it so much faster now?\u201d"})]}),"\n",(0,i.jsx)(a.p,{children:"Her teammate smiles:"}),"\n",(0,i.jsxs)(a.blockquote,{children:["\n",(0,i.jsx)(a.p,{children:"\u201cThat\u2019s Databricks caching. Used right, it can speed up your entire Lakehouse.\u201d"}),"\n"]}),"\n",(0,i.jsx)(a.p,{children:"Let\u2019s understand why caching can be your secret superpower."}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"-what-is-caching-in-databricks",children:"\ud83e\udde9 What Is Caching in Databricks?"}),"\n",(0,i.jsxs)(a.p,{children:["Caching means storing frequently accessed data in ",(0,i.jsx)(a.strong,{children:"memory"})," or ",(0,i.jsx)(a.strong,{children:"local SSDs"})," so queries run MUCH faster."]}),"\n",(0,i.jsxs)(a.p,{children:["Databricks supports ",(0,i.jsx)(a.strong,{children:"three types"})," of caching:"]}),"\n",(0,i.jsxs)(a.ol,{children:["\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Delta Cache"})," (Disk-based cache managed by Databricks)"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Spark Memory Cache"})," (Stored in RAM with ",(0,i.jsx)(a.code,{children:"CACHE TABLE"}),")"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Disk Cache"})," for Databricks SQL Warehouses"]}),"\n"]}),"\n",(0,i.jsx)(a.p,{children:"Each one accelerates repeated queries by avoiding costly reads from cloud storage (S3/ADLS/GCS)."}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"-type-1-delta-cache-databricks-runtime",children:"\ud83d\udd0d Type 1: Delta Cache (Databricks Runtime)"}),"\n",(0,i.jsx)(a.p,{children:"Activated automatically when reading from Delta tables."}),"\n",(0,i.jsx)(a.h3,{id:"how-it-works",children:"How it works:"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:"Cached on each worker node"}),"\n",(0,i.jsxs)(a.li,{children:["Stored on ",(0,i.jsx)(a.strong,{children:"local SSDs"}),", not RAM"]}),"\n",(0,i.jsx)(a.li,{children:"Persistent during the cluster lifetime"}),"\n",(0,i.jsx)(a.li,{children:"Great for BI dashboards & repeated table scans"}),"\n"]}),"\n",(0,i.jsx)(a.h3,{id:"enable-if-disabled",children:"Enable (if disabled):"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-sql",children:"SET spark.databricks.io.cache.enabled = true;\n"})}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"-type-2-spark-memory-cache",children:"\ud83d\udd0d Type 2: Spark Memory Cache"}),"\n",(0,i.jsx)(a.p,{children:"Manually cache tables into memory:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-sql",children:"CACHE SELECT * FROM transactions;\n"})}),"\n",(0,i.jsx)(a.p,{children:"or:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-sql",children:"CACHE TABLE transactions;\n"})}),"\n",(0,i.jsx)(a.h3,{id:"best-for",children:"Best for:"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:"Heavy compute transformations"}),"\n",(0,i.jsx)(a.li,{children:"Machine learning workloads"}),"\n",(0,i.jsx)(a.li,{children:"Repeated DataFrame operations in notebooks"}),"\n"]}),"\n",(0,i.jsx)(a.h3,{id:"limitations",children:"Limitations:"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:"Uses cluster RAM"}),"\n",(0,i.jsx)(a.li,{children:"Cache is lost if cluster goes down"}),"\n",(0,i.jsx)(a.li,{children:"Not ideal for very large tables"}),"\n"]}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"-type-3-databricks-sql-warehouse-cache",children:"\ud83d\udd0d Type 3: Databricks SQL Warehouse Cache"}),"\n",(0,i.jsx)(a.p,{children:"Used by BI tools and dashboards."}),"\n",(0,i.jsx)(a.h3,{id:"benefits",children:"Benefits:"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:"Fast interactive queries"}),"\n",(0,i.jsx)(a.li,{children:"Stores results & metadata"}),"\n",(0,i.jsx)(a.li,{children:"Extremely efficient for dashboards refreshing frequently"}),"\n"]}),"\n",(0,i.jsx)(a.p,{children:"Works automatically behind the scenes \u2014 no setup required."}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"-when-should-you-use-caching",children:"\u26a1 When Should You Use Caching?"}),"\n",(0,i.jsx)(a.h3,{id:"-use-caching-when",children:"\u2705 Use caching when:"}),"\n",(0,i.jsx)(a.p,{children:"\u2714 Running the same query multiple times\r\n\u2714 Interactive analysis (SQL editor, notebooks, BI tools)\r\n\u2714 Data fits into memory or SSD\r\n\u2714 You want ultra-fast dashboard loads\r\n\u2714 You run iterative ML transformations\r\n\u2714 You have hot tables read frequently"}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"-when-not-to-use-caching",children:"\u274c When NOT to Use Caching"}),"\n",(0,i.jsx)(a.h3,{id:"avoid-caching-when",children:"Avoid caching when:"}),"\n",(0,i.jsxs)(a.p,{children:["\u2716 Your table updates ",(0,i.jsx)(a.em,{children:"very"})," frequently (cache invalidation overhead)\r\n\u2716 Data is too large to fit in RAM or SSD\r\n\u2716 You are running one-time ETL jobs\r\n\u2716 Queries are always unique (no repetition)\r\n\u2716 You are using Job Clusters (cache resets every job)"]}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"-real-world-example--8-faster-dashboard",children:"\ud83e\uddea Real-World Example \u2014 8\xd7 Faster Dashboard"}),"\n",(0,i.jsx)(a.p,{children:"Mila\u2019s team has a PowerBI dashboard querying a Delta table every 10 minutes."}),"\n",(0,i.jsx)(a.p,{children:"Before caching:"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:"22-second load time"}),"\n",(0,i.jsx)(a.li,{children:"Frequent cluster spikes"}),"\n",(0,i.jsx)(a.li,{children:"Occasional timeouts"}),"\n"]}),"\n",(0,i.jsx)(a.p,{children:"After enabling caching on the cluster:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-sql",children:"CACHE TABLE sales_aggregated;\n"})}),"\n",(0,i.jsx)(a.p,{children:"Results:"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsxs)(a.li,{children:["Dashboard loads in ",(0,i.jsx)(a.strong,{children:"3 seconds"})]}),"\n",(0,i.jsx)(a.li,{children:"Cluster CPU dropped by 45%"}),"\n",(0,i.jsx)(a.li,{children:"BI team finally stopped complaining \ud83c\udf89"}),"\n"]}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"-how-to-check-if-cache-is-being-used",children:"\ud83d\udd27 How to Check If Cache Is Being Used"}),"\n",(0,i.jsx)(a.p,{children:"For Delta Cache:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-sql",children:"DESCRIBE DETAIL delta.`/path/to/table`;\n"})}),"\n",(0,i.jsx)(a.p,{children:"Or at runtime:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-sql",children:'spark.conf.get("spark.databricks.io.cache.enabled")\n'})}),"\n",(0,i.jsx)(a.p,{children:"For Memory Cache:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-sql",children:"SHOW TABLES;\n"})}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-sql",children:"CLEAR CACHE;\n"})}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"-best-practices-for-caching",children:"\ud83c\udfaf Best Practices for Caching"}),"\n",(0,i.jsx)(a.h3,{id:"-1-cache-only-hot-datasets",children:"\ud83d\udfe9 1. Cache only hot datasets"}),"\n",(0,i.jsx)(a.p,{children:"Avoid caching huge cold data."}),"\n",(0,i.jsx)(a.h3,{id:"-2-use-delta-cache-for-most-sql-workloads",children:"\ud83d\udfe9 2. Use Delta Cache for most SQL workloads"}),"\n",(0,i.jsx)(a.p,{children:"Lightweight and automatic."}),"\n",(0,i.jsx)(a.h3,{id:"-3-use-memory-cache-only-for-dataframe-heavy-notebooks",children:"\ud83d\udfe9 3. Use MEMORY cache only for DataFrame-heavy notebooks"}),"\n",(0,i.jsx)(a.p,{children:"Not for general SQL."}),"\n",(0,i.jsx)(a.h3,{id:"-4-dont-over-cache",children:"\ud83d\udfe9 4. Don\u2019t over-cache"}),"\n",(0,i.jsx)(a.p,{children:"Caching useless data = wasted resources."}),"\n",(0,i.jsx)(a.h3,{id:"-5-combine-caching-with-z-order--optimize",children:"\ud83d\udfe9 5. Combine caching with Z-ORDER + OPTIMIZE"}),"\n",(0,i.jsx)(a.p,{children:"They complement each other for performance."}),"\n",(0,i.jsx)(a.h3,{id:"-6-tune-cache-size-for-large-clusters",children:"\ud83d\udfe9 6. Tune cache size for large clusters"}),"\n",(0,i.jsx)(a.p,{children:"Use SSD-heavy clusters for maximum Delta Cache performance."}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h2,{id:"-summary",children:"\ud83d\udcd8 Summary"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.strong,{children:"Caching improves query speed dramatically"})," by storing frequently accessed data in memory or SSD."]}),"\n",(0,i.jsxs)(a.li,{children:["Databricks provides three caching layers: ",(0,i.jsx)(a.strong,{children:"Delta Cache"}),", ",(0,i.jsx)(a.strong,{children:"Spark Memory Cache"}),", and ",(0,i.jsx)(a.strong,{children:"SQL Warehouse Cache"}),"."]}),"\n",(0,i.jsx)(a.li,{children:"Best used for repeated queries, dashboards, ML workflows, and hot datasets."}),"\n",(0,i.jsx)(a.li,{children:"Avoid caching massive or frequently updated data."}),"\n",(0,i.jsx)(a.li,{children:"Use caching alongside OPTIMIZE, Z-ORDER, and file compaction for maximum Lakehouse performance."}),"\n"]}),"\n",(0,i.jsx)(a.p,{children:"Caching = Fast queries, low cost, happy analysts."}),"\n",(0,i.jsx)(a.hr,{}),"\n",(0,i.jsx)(a.h1,{id:"-next-topic",children:"\ud83d\udc49 Next Topic"}),"\n",(0,i.jsx)(a.p,{children:(0,i.jsx)(a.strong,{children:"Photon Execution Engine \u2014 When & Why to Use"})})]})}function d(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,i.jsx)(a,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,a,n)=>{n.d(a,{R:()=>c,x:()=>t});var s=n(6540);const i={},r=s.createContext(i);function c(e){const a=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function t(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(r.Provider,{value:a},e.children)}}}]);