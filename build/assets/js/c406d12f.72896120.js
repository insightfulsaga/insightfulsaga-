"use strict";(self.webpackChunkdatacraft_school=self.webpackChunkdatacraft_school||[]).push([[4430],{3507:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"performance-optimization","title":"Performance & Optimization (Speed + Cost) - part 1","description":"The Modern Story","source":"@site/docs-databricks/performance-optimization.md","sourceDirName":".","slug":"/performance-optimization","permalink":"/databricks/performance-optimization","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"performance-optimization","title":"Performance & Optimization (Speed + Cost) - part 1","sidebar_label":"Performance & Optimization - part 1"}}');var t=i(4848),s=i(8453);const a={id:"performance-optimization",title:"Performance & Optimization (Speed + Cost) - part 1",sidebar_label:"Performance & Optimization - part 1"},o=void 0,d={},l=[{value:"1. Partitioning &amp; Z-Ordering",id:"1-partitioning--z-ordering",level:2},{value:"What is Partitioning?",id:"what-is-partitioning",level:3},{value:"Why is Partitioning Good?",id:"why-is-partitioning-good",level:3},{value:"But Be Careful: Pitfalls of Partitioning",id:"but-be-careful-pitfalls-of-partitioning",level:3},{value:"What is Z-Ordering?",id:"what-is-z-ordering",level:3},{value:"Why is Z-Ordering Good?",id:"why-is-z-ordering-good",level:3},{value:"Pitfalls of Z-Ordering",id:"pitfalls-of-z-ordering",level:3},{value:"2. Caching &amp; Materialized Views",id:"2-caching--materialized-views",level:2},{value:"What is Caching?",id:"what-is-caching",level:3},{value:"\ud83d\udccb What are Materialized Views?",id:"-what-are-materialized-views",level:3},{value:"\u2705 Use Caching or Materialized Views When:",id:"-use-caching-or-materialized-views-when",level:3},{value:"\u26a0\ufe0f Pitfalls / Things to Watch",id:"\ufe0f-pitfalls--things-to-watch",level:3}];function c(e){const n={br:"br",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"The Modern Story"})}),"\n",(0,t.jsx)(n.p,{children:"Think of your data platform as a busy airport:-"}),"\n",(0,t.jsx)(n.p,{children:"-Flights (queries) are constantly taking off and landing.\r\n-Passengers (data) need to move quickly and efficiently.\r\n-Every delay or mismanagement costs both time and money."}),"\n",(0,t.jsx)(n.p,{children:"Now, how do we make this airport world-class?"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Partitioning = Terminals by Destination"}),(0,t.jsx)(n.br,{}),"\n","Instead of mixing all flights in one terminal, flights are split into ",(0,t.jsx)(n.code,{children:"Domestic"})," and ",(0,t.jsx)(n.code,{children:"International"}),", then further by ",(0,t.jsx)(n.code,{children:"region"}),". This way, security and passengers only deal with the ",(0,t.jsx)(n.strong,{children:"relevant section"}),", not the whole airport."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Z-Ordering \u2192 Priority Boarding"}),'\r\nInstead of boarding randomly, passengers are grouped (by zone or seat class). Similarly, Z-Ordering groups related data together, so queries can "board" faster without scanning the entire dataset.']}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Caching \u2192 Airport Lounges"}),'\r\nFrequent travelers don\u2019t go through long lines every time \u2014 they relax in lounges. Caching keeps frequently used data "on hand," avoiding repeated trips to cold storage.']}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Materialized Views = Pre-Scheduled Boarding Passes"}),(0,t.jsx)(n.br,{}),"\n","For routes like \u201cDaily New York\u2013London,\u201d the system preprints boarding passes every morning. Passengers don\u2019t have to wait in line for fresh processing \u2014 they get ready-made documents."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Data Skipping \u2192 Empty Gates Ignored"}),"\r\nAn efficient control tower doesn\u2019t check every gate if it knows some are empty. Data skipping avoids scanning irrelevant files, reducing unnecessary overhead."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Auto Optimize & Auto Compaction \u2192 Runway Maintenance"}),"\r\nA great airport runs smoothly because runways are constantly maintained without shutting down operations. Auto Optimize and compaction keep your Delta tables clean and query-ready behind the scenes."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Cluster Sizing & Photon \u2192 Choosing the Right Aircraft"}),"\r\nYou don\u2019t use a jumbo jet for 5 passengers or a small plane for 500. Photon + smart cluster sizing ensures the right compute power is used for the right workload."]}),"\n",(0,t.jsx)(n.p,{children:"\ud83d\udd11 As a Data Engineer, your role isn\u2019t just moving data \u2014 it\u2019s ensuring that your airport of data runs efficiently, reliably, and cost-effectively. Every choice \u2014 from Z-Ordering to caching \u2014 is like fine-tuning airport operations so passengers (data consumers) experience seamless travel."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Professional"}),"\r\nIn real-world Databricks projects, performance tuning isn\u2019t just about speed \u2014 it\u2019s about cost optimization:"]}),"\n",(0,t.jsx)(n.p,{children:"-Queries that run 2x faster often cost 3x less.\r\n-Well-partitioned, optimized data reduces cloud storage and compute waste.\r\n-Photon execution and adaptive cluster sizing directly impact your cloud bill."}),"\n",(0,t.jsx)(n.p,{children:"This involves performance optimization and tuning. Let\u2019s break it down step by step:"}),"\n",(0,t.jsx)(n.p,{children:"The main areas are:-"}),"\n",(0,t.jsx)(n.h2,{id:"1-partitioning--z-ordering",children:"1. Partitioning & Z-Ordering"}),"\n",(0,t.jsx)(n.p,{children:"Helps reduce the amount of data scanned."}),"\n",(0,t.jsx)(n.h3,{id:"what-is-partitioning",children:"What is Partitioning?"}),"\n",(0,t.jsx)(n.p,{children:"Partitioning means organizing your data into separate folders/files based on the values of certain columns."}),"\n",(0,t.jsx)(n.p,{children:"Think of it like this:"}),"\n",(0,t.jsx)(n.p,{children:"\ud83d\udcc1 sales/\r\n\u2514\u2500\u2500 \ud83d\udcc1 date=2025-08-28/\r\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\u2514\u2500\u2500 \ud83d\udcc1 region=APAC/\r\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\u2514\u2500\u2500 \ud83d\uddc2\ufe0f data files here"}),"\n",(0,t.jsx)(n.p,{children:"Instead of storing everything in one huge folder, you split it out by common filter columns \u2014 like date, region, or country."}),"\n",(0,t.jsx)(n.h3,{id:"why-is-partitioning-good",children:"Why is Partitioning Good?"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\ud83d\ude80 1. Speed (Partition Pruning)"}),"\r\nWhen you query data using a filter on a partitioned column, your system can skip scanning irrelevant folders entirely."]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM sales WHERE date = '2025-08-28'\n"})}),"\n",(0,t.jsx)(n.p,{children:"If data is partitioned by date, only the folder date=2025-08-28 is scanned.\r\nNo need to look inside thousands of other dates.\r\nThat\u2019s faster and cheaper.\r\nThis is called partition pruning."}),"\n",(0,t.jsx)(n.h3,{id:"but-be-careful-pitfalls-of-partitioning",children:"But Be Careful: Pitfalls of Partitioning"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\ud83d\udc1c 1. Too Many Partitions = Small File Problem"}),"\r\nIf you over-partition (e.g., use columns with millions of unique values like user_id), you get:\r\nTiny files spread across millions of folders\r\nOverhead in managing, listing, and reading those files\r\nPerformance becomes worse than no partitioning at all"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\ud83c\udfaf 2. Choose the Right Columns"}),"\r\nPartition columns should be:\r\nLow or medium cardinality \u2192 not too many unique values\r\n",(0,t.jsx)("u",{children:"Good:"})," date, region, country, device_type\r\n",(0,t.jsx)("u",{children:"Bad:"})," user_id, email, transaction_id\r\nFrequently used in filters\r\nIf you never filter by a partition column, the system can\u2019t take advantage of pruning."]}),"\n",(0,t.jsx)(n.h3,{id:"what-is-z-ordering",children:"What is Z-Ordering?"}),"\n",(0,t.jsx)(n.p,{children:"Z-Ordering is a technique that rearranges data inside files (within a partition) to make filtering more efficient."}),"\n",(0,t.jsx)(n.p,{children:"It\u2019s not about how the data is stored on disk in folders (like partitioning). Instead, it\u2019s about how rows are ordered inside the files."}),"\n",(0,t.jsx)(n.h3,{id:"why-is-z-ordering-good",children:"Why is Z-Ordering Good?"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u26a1 1. Faster Range Scans"})}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"WHERE customer_id BETWEEN 100 AND 200\n"})}),"\n",(0,t.jsx)(n.p,{children:"If data is Z-Ordered by customer_id, those rows are stored near each other, so the engine reads fewer blocks."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\ud83d\udcca 2. Works Well for High-Cardinality Columns"})}),"\n",(0,t.jsx)(n.p,{children:"Unlike partitioning, Z-Ordering is great for columns with lots of unique values:"}),"\n",(0,t.jsx)(n.p,{children:"customer_id\r\nproduct_id\r\nsession_id"}),"\n",(0,t.jsx)(n.p,{children:"Partitioning on these would create millions of folders \u2192 bad idea. But Z-Ordering keeps things organized inside files."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\ud83d\udd0d 3. Better for Multi-Column Filters"}),"\r\nExample:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"WHERE region = 'APAC' AND category = 'Electronics'\n"})}),"\n",(0,t.jsx)(n.p,{children:"If Z-Ordered by both columns, rows with this combination are co-located, making queries much faster."}),"\n",(0,t.jsx)(n.h3,{id:"pitfalls-of-z-ordering",children:"Pitfalls of Z-Ordering"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\ud83d\udcb8 1. Expensive Operation"})}),"\n",(0,t.jsx)(n.p,{children:"Z-Ordering isn't automatic."}),"\n",(0,t.jsx)(n.p,{children:"It requires a special job:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"OPTIMIZE gold.sales ZORDER BY (customer_id, region);\n"})}),"\n",(0,t.jsx)(n.p,{children:"This job rewrites the data, so it can:"}),"\n",(0,t.jsx)(n.p,{children:"--Take time\r\n--Consume compute resources"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\ud83d\udd01 2. Needs to be Done Periodically"})}),"\n",(0,t.jsx)(n.p,{children:"You don\u2019t Z-Order after every write.\r\nBest done as a batch job, e.g., daily or weekly, depending on data volume."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\ud83d\udd04 Combine with Partitioning (Best Practice)"})}),"\n",(0,t.jsx)(n.p,{children:"They work together, not against each other."}),"\n",(0,t.jsxs)(n.p,{children:["Technique\tBest for\r\n",(0,t.jsx)(n.strong,{children:"Partitioning"})," Columns with few unique values (e.g., date, region) that are always filtered on\r\n",(0,t.jsx)(n.strong,{children:"Z-Ordering"}),"\tColumns with many unique values (e.g., customer_id, product_id) that are frequently queried"]}),"\n",(0,t.jsx)(n.p,{children:"\u2705 Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Partition by date (low-cardinality)\r\nCREATE TABLE gold.sales (\r\n  order_id STRING,\r\n  customer_id STRING,\r\n  amount DECIMAL(10,2),\r\n  order_date DATE,\r\n  region STRING\r\n)\r\nUSING DELTA\r\nPARTITIONED BY (order_date);\r\n\r\n-- Periodically run:\r\nOPTIMIZE gold.sales\r\nZORDER BY (customer_id, region);\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Summary:-"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\ud83e\udde0 Concept"}),(0,t.jsx)(n.th,{children:"\u2705 Good For"}),(0,t.jsx)(n.th,{children:"\u26a0\ufe0f Watch Out"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Partitioning"})}),(0,t.jsxs)(n.td,{children:["Low-cardinality columns (e.g. ",(0,t.jsx)(n.code,{children:"date"}),", ",(0,t.jsx)(n.code,{children:"region"}),")"]}),(0,t.jsx)(n.td,{children:"Too many = small file problem"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Z-Ordering"})}),(0,t.jsxs)(n.td,{children:["High-cardinality columns used in filters (e.g. ",(0,t.jsx)(n.code,{children:"customer_id"}),")"]}),(0,t.jsx)(n.td,{children:"Expensive to run; not real-time"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Use Together"})}),(0,t.jsxs)(n.td,{children:["Partition by ",(0,t.jsx)(n.code,{children:"date"}),", Z-Order by ",(0,t.jsx)(n.code,{children:"customer_id"})]}),(0,t.jsx)(n.td,{children:"Best for big datasets"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"2-caching--materialized-views",children:"2. Caching & Materialized Views"}),"\n",(0,t.jsx)(n.h3,{id:"what-is-caching",children:"What is Caching?"}),"\n",(0,t.jsx)(n.p,{children:"Caching means storing data in memory (RAM) so it can be accessed much faster than reading it from disk again."}),"\n",(0,t.jsx)(n.p,{children:"Imagine keeping your most-used documents on your desk instead of in a filing cabinet \u2014 you reach them instantly."}),"\n",(0,t.jsx)(n.p,{children:"Example in Spark:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'df = spark.table("gold.daily_revenue")\r\ndf.cache()       # Tell Spark: keep this in memory\r\ndf.count()       # Actually triggers the cache ("materialize" it)\n'})}),"\n",(0,t.jsx)(n.p,{children:"After this, future queries on df will be much faster, as Spark doesn\u2019t have to read and compute it again."}),"\n",(0,t.jsx)(n.h3,{id:"-what-are-materialized-views",children:"\ud83d\udccb What are Materialized Views?"}),"\n",(0,t.jsx)(n.p,{children:"A Materialized View is like a saved result of a complex query."}),"\n",(0,t.jsx)(n.p,{children:"Think of it as pre-computed data stored like a table."}),"\n",(0,t.jsx)(n.p,{children:"Unlike regular views (which run the query every time), materialized views are updated only on demand or on a schedule."}),"\n",(0,t.jsx)(n.p,{children:"\u2705 Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE MATERIALIZED VIEW daily_revenue_mv AS\r\nSELECT date, SUM(amount) as total\r\nFROM sales\r\nGROUP BY date;\n"})}),"\n",(0,t.jsx)(n.p,{children:"This saves the result as a physical table, which can be indexed, cached, and queried quickly."}),"\n",(0,t.jsx)(n.h3,{id:"-use-caching-or-materialized-views-when",children:"\u2705 Use Caching or Materialized Views When:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Use Case"}),(0,t.jsx)(n.th,{children:"\u2705 Good Fit"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Dashboards"})}),(0,t.jsx)(n.td,{children:"Same data queried many times (e.g., daily sales)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Stable data"})}),(0,t.jsx)(n.td,{children:"Data that doesn\u2019t change frequently"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Complex aggregations"})}),(0,t.jsx)(n.td,{children:"Repeating heavy GROUP BY or JOIN logic"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Interactive queries"})}),(0,t.jsx)(n.td,{children:"Need speed in BI tools (e.g., Power BI, Tableau, Databricks SQL)"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"\ufe0f-pitfalls--things-to-watch",children:"\u26a0\ufe0f Pitfalls / Things to Watch"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Concept"}),(0,t.jsx)(n.th,{children:"Gotchas"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Caching"})}),(0,t.jsxs)(n.td,{children:["Data must fit in memory; use ",(0,t.jsx)(n.code,{children:".cache()"})," only if reused a lot"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Materialized Views"})}),(0,t.jsxs)(n.td,{children:["They ",(0,t.jsx)(n.strong,{children:"can go stale"}),"; you must ",(0,t.jsx)(n.strong,{children:"refresh"})," them manually or on schedule"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Cache doesn't update"})}),(0,t.jsx)(n.td,{children:"If source data changes, the cached version stays the same until dropped or reloaded"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var r=i(6540);const t={},s=r.createContext(t);function a(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);