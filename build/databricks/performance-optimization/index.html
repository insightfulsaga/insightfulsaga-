<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-databricks docs-version-current docs-doc-page docs-doc-id-performance-optimization" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Performance &amp; Optimization (Speed + Cost) - part 1 | InsightFul Saga</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.insightfulsaga.com/img/logo.svg"><meta data-rh="true" name="twitter:image" content="https://www.insightfulsaga.com/img/logo.svg"><meta data-rh="true" property="og:url" content="https://www.insightfulsaga.com/databricks/performance-optimization"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-databricks-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-databricks-current"><meta data-rh="true" property="og:title" content="Performance &amp; Optimization (Speed + Cost) - part 1 | InsightFul Saga"><meta data-rh="true" name="description" content="The Modern Story"><meta data-rh="true" property="og:description" content="The Modern Story"><link data-rh="true" rel="icon" href="/static/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.insightfulsaga.com/databricks/performance-optimization"><link data-rh="true" rel="alternate" href="https://www.insightfulsaga.com/databricks/performance-optimization" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.insightfulsaga.com/databricks/performance-optimization" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.276929d1.css">
<script src="/assets/js/runtime~main.b7d737c3.js" defer="defer"></script>
<script src="/assets/js/main.6ec70ae4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="techBar_gVZk"><button class="hamburger_W7qc"><span></span><span></span><span></span></button><div class="techContent_bR50"><a class="" href="/pyspark/pyspark-intro">PySpark</a><a class="" href="/snowflake/snowflake-intro">Snowflake</a><a class="activeLink_puE3" href="/databricks/databricks-intro">Databricks</a></div></div><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Performance &amp; Optimization (Speed + Cost) - part 1</h1></header><p><strong>The Modern Story</strong></p>
<p>Think of your data platform as a busy airport:-</p>
<p>-Flights (queries) are constantly taking off and landing.
-Passengers (data) need to move quickly and efficiently.
-Every delay or mismanagement costs both time and money.</p>
<p>Now, how do we make this airport world-class?</p>
<p><strong>Partitioning = Terminals by Destination</strong><br>
<!-- -->Instead of mixing all flights in one terminal, flights are split into <code>Domestic</code> and <code>International</code>, then further by <code>region</code>. This way, security and passengers only deal with the <strong>relevant section</strong>, not the whole airport.</p>
<p><strong>Z-Ordering â†’ Priority Boarding</strong>
Instead of boarding randomly, passengers are grouped (by zone or seat class). Similarly, Z-Ordering groups related data together, so queries can &quot;board&quot; faster without scanning the entire dataset.</p>
<p><strong>Caching â†’ Airport Lounges</strong>
Frequent travelers donâ€™t go through long lines every time â€” they relax in lounges. Caching keeps frequently used data &quot;on hand,&quot; avoiding repeated trips to cold storage.</p>
<p><strong>Materialized Views = Pre-Scheduled Boarding Passes</strong><br>
<!-- -->For routes like â€œDaily New Yorkâ€“London,â€ the system preprints boarding passes every morning. Passengers donâ€™t have to wait in line for fresh processing â€” they get ready-made documents.</p>
<p><strong>Data Skipping â†’ Empty Gates Ignored</strong>
An efficient control tower doesnâ€™t check every gate if it knows some are empty. Data skipping avoids scanning irrelevant files, reducing unnecessary overhead.</p>
<p><strong>Auto Optimize &amp; Auto Compaction â†’ Runway Maintenance</strong>
A great airport runs smoothly because runways are constantly maintained without shutting down operations. Auto Optimize and compaction keep your Delta tables clean and query-ready behind the scenes.</p>
<p><strong>Cluster Sizing &amp; Photon â†’ Choosing the Right Aircraft</strong>
You donâ€™t use a jumbo jet for 5 passengers or a small plane for 500. Photon + smart cluster sizing ensures the right compute power is used for the right workload.</p>
<p>ğŸ”‘ As a Data Engineer, your role isnâ€™t just moving data â€” itâ€™s ensuring that your airport of data runs efficiently, reliably, and cost-effectively. Every choice â€” from Z-Ordering to caching â€” is like fine-tuning airport operations so passengers (data consumers) experience seamless travel.</p>
<p><strong>Professional</strong>
In real-world Databricks projects, performance tuning isnâ€™t just about speed â€” itâ€™s about cost optimization:</p>
<p>-Queries that run 2x faster often cost 3x less.
-Well-partitioned, optimized data reduces cloud storage and compute waste.
-Photon execution and adaptive cluster sizing directly impact your cloud bill.</p>
<p>This involves performance optimization and tuning. Letâ€™s break it down step by step:</p>
<p>The main areas are:-</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-partitioning--z-ordering">1. Partitioning &amp; Z-Ordering<a href="#1-partitioning--z-ordering" class="hash-link" aria-label="Direct link to 1. Partitioning &amp; Z-Ordering" title="Direct link to 1. Partitioning &amp; Z-Ordering" translate="no">â€‹</a></h2>
<p>Helps reduce the amount of data scanned.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-partitioning">What is Partitioning?<a href="#what-is-partitioning" class="hash-link" aria-label="Direct link to What is Partitioning?" title="Direct link to What is Partitioning?" translate="no">â€‹</a></h3>
<p>Partitioning means organizing your data into separate folders/files based on the values of certain columns.</p>
<p>Think of it like this:</p>
<p>ğŸ“ sales/
â””â”€â”€ ğŸ“ date=2025-08-28/
Â Â Â Â Â Â Â Â â””â”€â”€ ğŸ“ region=APAC/
Â Â Â Â Â Â Â Â Â Â Â Â â””â”€â”€ ğŸ—‚ï¸ data files here</p>
<p>Instead of storing everything in one huge folder, you split it out by common filter columns â€” like date, region, or country.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-is-partitioning-good">Why is Partitioning Good?<a href="#why-is-partitioning-good" class="hash-link" aria-label="Direct link to Why is Partitioning Good?" title="Direct link to Why is Partitioning Good?" translate="no">â€‹</a></h3>
<p><strong>ğŸš€ 1. Speed (Partition Pruning)</strong>
When you query data using a filter on a partitioned column, your system can skip scanning irrelevant folders entirely.</p>
<p>Example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> sales </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">date</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2025-08-28&#x27;</span><br></span></code></pre></div></div>
<p>If data is partitioned by date, only the folder date=2025-08-28 is scanned.
No need to look inside thousands of other dates.
Thatâ€™s faster and cheaper.
This is called partition pruning.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="but-be-careful-pitfalls-of-partitioning">But Be Careful: Pitfalls of Partitioning<a href="#but-be-careful-pitfalls-of-partitioning" class="hash-link" aria-label="Direct link to But Be Careful: Pitfalls of Partitioning" title="Direct link to But Be Careful: Pitfalls of Partitioning" translate="no">â€‹</a></h3>
<p><strong>ğŸœ 1. Too Many Partitions = Small File Problem</strong>
If you over-partition (e.g., use columns with millions of unique values like user_id), you get:
Tiny files spread across millions of folders
Overhead in managing, listing, and reading those files
Performance becomes worse than no partitioning at all</p>
<p><strong>ğŸ¯ 2. Choose the Right Columns</strong>
Partition columns should be:
Low or medium cardinality â†’ not too many unique values
<u>Good:</u> date, region, country, device_type
<u>Bad:</u> user_id, email, transaction_id
Frequently used in filters
If you never filter by a partition column, the system canâ€™t take advantage of pruning.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-z-ordering">What is Z-Ordering?<a href="#what-is-z-ordering" class="hash-link" aria-label="Direct link to What is Z-Ordering?" title="Direct link to What is Z-Ordering?" translate="no">â€‹</a></h3>
<p>Z-Ordering is a technique that rearranges data inside files (within a partition) to make filtering more efficient.</p>
<p>Itâ€™s not about how the data is stored on disk in folders (like partitioning). Instead, itâ€™s about how rows are ordered inside the files.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-is-z-ordering-good">Why is Z-Ordering Good?<a href="#why-is-z-ordering-good" class="hash-link" aria-label="Direct link to Why is Z-Ordering Good?" title="Direct link to Why is Z-Ordering Good?" translate="no">â€‹</a></h3>
<p><strong>âš¡ 1. Faster Range Scans</strong></p>
<p>Example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> customer_id </span><span class="token operator" style="color:#393A34">BETWEEN</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><br></span></code></pre></div></div>
<p>If data is Z-Ordered by customer_id, those rows are stored near each other, so the engine reads fewer blocks.</p>
<p><strong>ğŸ“Š 2. Works Well for High-Cardinality Columns</strong></p>
<p>Unlike partitioning, Z-Ordering is great for columns with lots of unique values:</p>
<p>customer_id
product_id
session_id</p>
<p>Partitioning on these would create millions of folders â†’ bad idea. But Z-Ordering keeps things organized inside files.</p>
<p><strong>ğŸ” 3. Better for Multi-Column Filters</strong>
Example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> region </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;APAC&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> category </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Electronics&#x27;</span><br></span></code></pre></div></div>
<p>If Z-Ordered by both columns, rows with this combination are co-located, making queries much faster.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pitfalls-of-z-ordering">Pitfalls of Z-Ordering<a href="#pitfalls-of-z-ordering" class="hash-link" aria-label="Direct link to Pitfalls of Z-Ordering" title="Direct link to Pitfalls of Z-Ordering" translate="no">â€‹</a></h3>
<p><strong>ğŸ’¸ 1. Expensive Operation</strong></p>
<p>Z-Ordering isn&#x27;t automatic.</p>
<p>It requires a special job:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">OPTIMIZE</span><span class="token plain"> gold</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sales ZORDER </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">customer_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> region</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>This job rewrites the data, so it can:</p>
<p>--Take time
--Consume compute resources</p>
<p><strong>ğŸ” 2. Needs to be Done Periodically</strong></p>
<p>You donâ€™t Z-Order after every write.
Best done as a batch job, e.g., daily or weekly, depending on data volume.</p>
<p><strong>ğŸ”„ Combine with Partitioning (Best Practice)</strong></p>
<p>They work together, not against each other.</p>
<p>Technique	Best for
<strong>Partitioning</strong> Columns with few unique values (e.g., date, region) that are always filtered on
<strong>Z-Ordering</strong>	Columns with many unique values (e.g., customer_id, product_id) that are frequently queried</p>
<p>âœ… Example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Partition by date (low-cardinality)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> gold</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sales </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  order_id STRING</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  customer_id STRING</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  amount </span><span class="token keyword" style="color:#00009f">DECIMAL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  order_date </span><span class="token keyword" style="color:#00009f">DATE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  region STRING</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">USING</span><span class="token plain"> DELTA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PARTITIONED </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">order_date</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Periodically run:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">OPTIMIZE</span><span class="token plain"> gold</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sales</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZORDER </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">customer_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> region</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><strong>Summary:-</strong></p>
<table><thead><tr><th>ğŸ§  Concept</th><th>âœ… Good For</th><th>âš ï¸ Watch Out</th></tr></thead><tbody><tr><td><strong>Partitioning</strong></td><td>Low-cardinality columns (e.g. <code>date</code>, <code>region</code>)</td><td>Too many = small file problem</td></tr><tr><td><strong>Z-Ordering</strong></td><td>High-cardinality columns used in filters (e.g. <code>customer_id</code>)</td><td>Expensive to run; not real-time</td></tr><tr><td><strong>Use Together</strong></td><td>Partition by <code>date</code>, Z-Order by <code>customer_id</code></td><td>Best for big datasets</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-caching--materialized-views">2. Caching &amp; Materialized Views<a href="#2-caching--materialized-views" class="hash-link" aria-label="Direct link to 2. Caching &amp; Materialized Views" title="Direct link to 2. Caching &amp; Materialized Views" translate="no">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-caching">What is Caching?<a href="#what-is-caching" class="hash-link" aria-label="Direct link to What is Caching?" title="Direct link to What is Caching?" translate="no">â€‹</a></h3>
<p>Caching means storing data in memory (RAM) so it can be accessed much faster than reading it from disk again.</p>
<p>Imagine keeping your most-used documents on your desk instead of in a filing cabinet â€” you reach them instantly.</p>
<p>Example in Spark:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> spark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">table</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;gold.daily_revenue&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># Tell Spark: keep this in memory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># Actually triggers the cache (&quot;materialize&quot; it)</span><br></span></code></pre></div></div>
<p>After this, future queries on df will be much faster, as Spark doesnâ€™t have to read and compute it again.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-what-are-materialized-views">ğŸ“‹ What are Materialized Views?<a href="#-what-are-materialized-views" class="hash-link" aria-label="Direct link to ğŸ“‹ What are Materialized Views?" title="Direct link to ğŸ“‹ What are Materialized Views?" translate="no">â€‹</a></h3>
<p>A Materialized View is like a saved result of a complex query.</p>
<p>Think of it as pre-computed data stored like a table.</p>
<p>Unlike regular views (which run the query every time), materialized views are updated only on demand or on a schedule.</p>
<p>âœ… Example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> MATERIALIZED </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> daily_revenue_mv </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">date</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SUM</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> sales</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">date</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>This saves the result as a physical table, which can be indexed, cached, and queried quickly.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-use-caching-or-materialized-views-when">âœ… Use Caching or Materialized Views When:<a href="#-use-caching-or-materialized-views-when" class="hash-link" aria-label="Direct link to âœ… Use Caching or Materialized Views When:" title="Direct link to âœ… Use Caching or Materialized Views When:" translate="no">â€‹</a></h3>
<table><thead><tr><th>Use Case</th><th>âœ… Good Fit</th></tr></thead><tbody><tr><td><strong>Dashboards</strong></td><td>Same data queried many times (e.g., daily sales)</td></tr><tr><td><strong>Stable data</strong></td><td>Data that doesnâ€™t change frequently</td></tr><tr><td><strong>Complex aggregations</strong></td><td>Repeating heavy GROUP BY or JOIN logic</td></tr><tr><td><strong>Interactive queries</strong></td><td>Need speed in BI tools (e.g., Power BI, Tableau, Databricks SQL)</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ï¸-pitfalls--things-to-watch">âš ï¸ Pitfalls / Things to Watch<a href="#ï¸-pitfalls--things-to-watch" class="hash-link" aria-label="Direct link to âš ï¸ Pitfalls / Things to Watch" title="Direct link to âš ï¸ Pitfalls / Things to Watch" translate="no">â€‹</a></h3>
<table><thead><tr><th>Concept</th><th>Gotchas</th></tr></thead><tbody><tr><td><strong>Caching</strong></td><td>Data must fit in memory; use <code>.cache()</code> only if reused a lot</td></tr><tr><td><strong>Materialized Views</strong></td><td>They <strong>can go stale</strong>; you must <strong>refresh</strong> them manually or on schedule</td></tr><tr><td><strong>Cache doesn&#x27;t update</strong></td><td>If source data changes, the cached version stays the same until dropped or reloaded</td></tr></tbody></table></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-partitioning--z-ordering" class="table-of-contents__link toc-highlight">1. Partitioning &amp; Z-Ordering</a><ul><li><a href="#what-is-partitioning" class="table-of-contents__link toc-highlight">What is Partitioning?</a></li><li><a href="#why-is-partitioning-good" class="table-of-contents__link toc-highlight">Why is Partitioning Good?</a></li><li><a href="#but-be-careful-pitfalls-of-partitioning" class="table-of-contents__link toc-highlight">But Be Careful: Pitfalls of Partitioning</a></li><li><a href="#what-is-z-ordering" class="table-of-contents__link toc-highlight">What is Z-Ordering?</a></li><li><a href="#why-is-z-ordering-good" class="table-of-contents__link toc-highlight">Why is Z-Ordering Good?</a></li><li><a href="#pitfalls-of-z-ordering" class="table-of-contents__link toc-highlight">Pitfalls of Z-Ordering</a></li></ul></li><li><a href="#2-caching--materialized-views" class="table-of-contents__link toc-highlight">2. Caching &amp; Materialized Views</a><ul><li><a href="#what-is-caching" class="table-of-contents__link toc-highlight">What is Caching?</a></li><li><a href="#-what-are-materialized-views" class="table-of-contents__link toc-highlight">ğŸ“‹ What are Materialized Views?</a></li><li><a href="#-use-caching-or-materialized-views-when" class="table-of-contents__link toc-highlight">âœ… Use Caching or Materialized Views When:</a></li><li><a href="#ï¸-pitfalls--things-to-watch" class="table-of-contents__link toc-highlight">âš ï¸ Pitfalls / Things to Watch</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/pyspark/pyspark-intro">Pyspark</a></li><li class="footer__item"><a class="footer__link-item" href="/snowflake/snowflake-intro">Snowflake</a></li><li class="footer__item"><a class="footer__link-item" href="/databricks/databricks-intro">Databricks</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Explore</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">About</a></li><li class="footer__item"><a class="footer__link-item" href="/contact">Contact</a></li><li class="footer__item"><a class="footer__link-item" href="/faq">FAQs</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cookie-policy">Cookie Policy</a></li><li class="footer__item"><a class="footer__link-item" href="/terms-of-use">Terms of use</a></li><li class="footer__item"><a class="footer__link-item" href="/privacy-policy">Privacy Policy</a></li><li class="footer__item"><a class="footer__link-item" href="/disclaimer">Disclaimer</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2025 Insightful Saga â€” â€” Where Data Meets Narrative. Crafted with clarity. One Chapter at a Time</div></div></div></footer></div>
</body>
</html>